@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@model List<Member>

<div class="container mt-5">
    <h1 class="mb-4">Lista de miembros</h1>

    <div class="d-flex justify-content-between mb-3">
        <a asp-action="Create" class="btn btn-primary">Agregar nuevo miembro</a>
    </div>

    <div class="table-responsive">
        <table id="membersTable" class="table-striped table-hover table">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Nombre completo</th>
                    <th>Correo</th>
                    <th>Fecha de suscripcion</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var member in Model)
                {
                    <tr>
                        <td>@member.Id</td>
                        <td>@member.FullName</td>
                        <td>@member.Email</td>
                        <td>@member.JoinDate.ToString("yyyy-MM-dd")</td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@member.Id" class="btn btn-sm btn-warning">Editar</a>
                            <button class="btn btn-sm btn-danger delete-btn" data-id="@member.Id">Eliminar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Delete button click handler con manejo mejorado
            $(document).on('click', '.delete-btn', function() {
                const id = $(this).data('id');
                const row = $(this).closest('tr');

                Swal.fire({
                    title: 'Confirmar',
                    text: "No podras revertir esta accion!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Eliminar',
                    cancelButtonText: 'Cancelar',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '@Url.Action("Delete", "Members")/' + id,
                            type: 'POST',
                            success: function(response) {
                                if (response.success) {
                                    row.fadeOut(400, function() {
                                        $(this).remove();
                                    });
                                    Swal.fire(
                                        'Eliminado!',
                                        response.message,
                                        'success'
                                    );
                                } else {
                                    Swal.fire(
                                        'Error!',
                                        response.message,
                                        'error'
                                    );
                                }
                            },
                            error: function() {
                                Swal.fire(
                                    'Error!',
                                    'Error de conexion',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });
        });
    </script>
}